#!/usr/bin/python

import sys, os

def ceildiv(a, b):
    return -(-a // b)

def generateCurl(lessonId, index, title, body):
    content="------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"script_conversions-TOTAL_FORMS\"\\r\\n\\r\\n1\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"script_conversions-INITIAL_FORMS\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"script_conversions-MAX_NUM_FORMS\"\\r\\n\\r\\n1000\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"translations-TOTAL_FORMS\"\\r\\n\\r\\n1\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"translations-INITIAL_FORMS\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"translations-MAX_NUM_FORMS\"\\r\\n\\r\\n1000\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-TOTAL_FORMS\"\\r\\n\\r\\n1\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-INITIAL_FORMS\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-MAX_NUM_FORMS\"\\r\\n\\r\\n1000\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"lesson_notes-TOTAL_FORMS\"\\r\\n\\r\\n1\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"lesson_notes-INITIAL_FORMS\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"lesson_notes-MAX_NUM_FORMS\"\\r\\n\\r\\n1000\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"exercises-TOTAL_FORMS\"\\r\\n\\r\\n1\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"exercises-INITIAL_FORMS\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"exercises-MAX_NUM_FORMS\"\\r\\n\\r\\n1000\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-TOTAL_FORMS\"\\r\\n\\r\\n1\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-INITIAL_FORMS\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-MAX_NUM_FORMS\"\\r\\n\\r\\n1000\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"add\"\\r\\n\\r\\nadd\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"collection\"\\r\\n\\r\\n%s\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"language\"\\r\\n\\r\\n2\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"title\"\\r\\n\\r\\n%s\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"original_url\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"description\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"text\"\\r\\n\\r\\n<p>%s</p>\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"image_path\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"image_file\"; filename=\"\"\\r\\nContent-Type: application/octet-stream\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"image_width\"\\r\\n\\r\\n120\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"image_height\"\\r\\n\\r\\n120\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"image_token\"\\r\\n\\r\\n3a00e36c8b95128303b92d5f1e27179c\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"category\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"type\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"level\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"accent\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"audio\"; filename=\"\"\\r\\nContent-Type: application/octet-stream\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"provider\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"external_audio\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"duration\"\\r\\n\\r\\n0\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"pos\"\\r\\n\\r\\n%s\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"lesson_notes-0-id\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"lesson_notes-0-language\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"lesson_notes-0-notes\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"translations-0-id\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"translations-0-language\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"translations-0-translation\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-0-id\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-0-language\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-0-youtube_url\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"videos-0-description\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"script_conversions-0-id\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"script_conversions-0-script\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"script_conversions-0-conversion\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"exercises-0-id\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"exercises-0-language\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"exercises-0-exercises\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-0-id\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-0-language\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-0-title\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd\\r\\nContent-Disposition: form-data; name=\"attachments-0-attachment\"; filename=\"\"\\r\\nContent-Type: application/octet-stream\\r\\n\\r\\n\\r\\n------WebKitFormBoundary8uaFxBBQmUd0vpwd--\\r\\n" % (lessonId, title, body, index)
    cookie="-H 'Cookie: __utma=206362254.437730297.1387535086.1388416849.1388419620.60; __utmz=206362254.1388330626.52.5.utmcsr=lingq.com|utmccn=(referral)|utmcmd=referral|utmcct=/learn/en/workdesk/item/6674799/reader/; __unam=cfda8e5-1430f89603f-64758dbc-519; __utmc=206362254; __utmb=206362254.12.10.1388419620; mp_5665c48c7007982ba4ed42561b91bb50_mixpanel=%7B%22distinct_id%22%3A%20%22379536%22%2C%22mp_name_tag%22%3A%20%22spatterson%22%2C%22tier%22%3A%20%221%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%7D'" 
    #cookie="-H 'Cookie: welcomefilters=event%3Dconversation%26event%3Dsubmission%26event%3Dlesson%26event%3Dlingq%26event%3Dwall%26event%3Davatar%26content_type%3Dlessons%26level%3D2; vk=ecfd31b6-a062-571c-bd01-a062247508ce; __qca=P0-1907082751-1353462758555; optimizelyEndUserId=oeu1354320359851r0.021708657266572118; optimizelySegments=%7B%7D; optimizelyBuckets=%7B%7D; disable_auto_scroll=1; NB_SRVID=srv11985; __atuvc=12%7C43; wwwlingqcomsa=2jot35s42k41lj8ihueq4sk2wja3yz06; __utma=206362254.631585034.1352939870.1382788268.1382862214.81; __utmb=206362254.2.10.1382862214; __utmc=206362254; __utmz=206362254.1382774487.78.3.utmcsr=lingq.com|utmccn=(referral)|utmcmd=referral|utmcct=/learn/de/workdesk/item/6349470/reader/; mp_5665c48c7007982ba4ed42561b91bb50_mixpanel=%7B%22distinct_id%22%3A%20%22379536%22%2C%22mp_name_tag%22%3A%20%22spatterson%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%2C%22tier%22%3A%20%221%22%7D; __unam=cfda8e5-141e684ac01-632a3bb2-92'"
    output = "curl 'http://www.lingq.com/learn/de/import/contents/' -H 'Pragma: no-cache' -H 'Origin: http://www.lingq.com' -H 'Accept-Encoding: gzip,deflate,sdch' -H 'Host: www.lingq.com' -H 'Accept-Language: en-US,en;q=0.8' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.65 Safari/537.36' -H 'Content-Type: multipart/form-data; boundary=----WebKitFormBoundary8uaFxBBQmUd0vpwd' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Cache-Control: no-cache' -H 'Referer: http://www.lingq.com/learn/de/import/contents/?add' "
    output = ''.join([output, cookie])
    output = "%s -H 'Connection: keep-alive' " % output
    output = "%s --data-binary $'%s' --compressed" % (output, content)
    
    return output


def main():
    fileName=sys.argv[1]
    numLines=int(sys.argv[2])
    i=int(sys.argv[3])

    with open(fileName) as f:
        unformattedLines = f.read().splitlines()

    lines = []
    for l in unformattedLines:
        lines.append(l.replace("'", "\'"))

    numPieces = ceildiv(len(lines), numLines)

    #for i in range(0, numPieces):
    #title="Harry Potter - Part %s/%s" % (i, numPieces)
    title="Harry Potter - TEST Part %s/%s" % (i, numPieces)
    segment = lines[i*numLines:i*numLines+numLines]
    body = '<br/>'.join(segment)
    print generateCurl(129927, i, title, body)

if __name__== "__main__":
    main()
